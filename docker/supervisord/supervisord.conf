[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock


[program:ASC.Files]
command=dotnet ASC.Files.dll --urls=http://0.0.0.0:5007 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Files
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Files.Worker]
command=dotnet ASC.Files.Worker.dll --urls=http://0.0.0.0:5009 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Files.Worker 
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.People]
command=dotnet ASC.People.dll --urls=http://0.0.0.0:5004 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.People
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Web.Api]
command=dotnet ASC.Web.Api.dll --urls=http://0.0.0.0:5000 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Web.Api
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.AI]
command=dotnet ASC.AI.dll --urls=http://0.0.0.0:5157 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.AI
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Web.Studio]
command=dotnet ASC.Web.Studio.dll --urls=http://0.0.0.0:5003 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Web.Studio core:eventBus:subscriptionClientName=asc_event_bus_webstudio_queue
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.ApiSystem]
command=dotnet ASC.ApiSystem.dll --urls=http://0.0.0.0:5010 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.ApiSystem
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Data.Backup]
command=dotnet ASC.Data.Backup.dll --urls=http://0.0.0.0:5012 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Data.Backup
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Data.Backup.Worker]
command=dotnet ASC.Data.Backup.Worker.dll --urls=http://0.0.0.0:5032 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Data.Backup.Worker "core:eventBus:subscriptionClientName=asc_event_bus_backup_queue"
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.ClearEvents]
command=dotnet ASC.ClearEvents.dll --urls=http://0.0.0.0:5027 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.ClearEvents
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Notify]
command=dotnet ASC.Notify.dll --urls=http://0.0.0.0:5005 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Notify "core:eventBus:subscriptionClientName=asc_event_bus_notify_queue"
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Studio.Notify]
command=dotnet ASC.Studio.Notify.dll --urls=http://0.0.0.0:5006 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.Studio.Notify
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.AI.Worker]
command=dotnet ASC.AI.Worker.dll --urls=http://0.0.0.0:5124 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.AI.Worker "core:eventBus:subscriptionClientName=asc_event_bus_ai_service_queue"
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.TelegramService]
command=dotnet ASC.TelegramService.dll --urls=http://0.0.0.0:5075 --'$STORAGE_ROOT'=%(ENV_APP_STORAGE_ROOT)s --ENVIRONMENT=%(ENV_ENV_EXTENSION)s --pathToConf=%(ENV_PATH_TO_CONF)s --log:dir=%(ENV_LOG_DIR)s --log:name=ASC.TelegramService "core:eventBus:subscriptionClientName=asc_event_bus_telegram_queue"
directory=%(ENV_SRC_PATH)s/publish/services/backend
autorestart=true
priority=300
startsecs=10

[program:ASC.Editors]
command=node server.js --app.port=5013 --app.hostname=0.0.0.0 --app.appsettings=%(ENV_PATH_TO_CONF)s   
directory=%(ENV_BUILD_PATH)s/editor
autorestart=true
priority=300
startsecs=10

[program:ASC.Login]
command=node server.js --app.port=5011 --app.hostname=0.0.0.0 --app.appsettings=%(ENV_PATH_TO_CONF)s   
directory=%(ENV_BUILD_PATH)s/login
autorestart=true
priority=300
startsecs=10

[program:ASC.Socket.IO]
command=node server.js --app.port=9899 --app.appsettings=%(ENV_PATH_TO_CONF)s   
directory=%(ENV_SRC_PATH)s/publish/services/ASC.Socket.IO
autorestart=true
priority=300
startsecs=10

[program:init_nginx]
command=/nginx/docker-entrypoint.sh
autorestart=false
startretries=1
priority=200

[program:openresty]
command=bash -c 'sleep 20 && /usr/local/openresty/bin/openresty -g "daemon off;"'
autostart=true
autorestart=true
startretries=5
stderr_logfile=/var/log/supervisor/openresty_stderr.log
stderr_logfile_maxbytes=10MB
stdout_logfile=/var/log/supervisor/openresty_stdout.log
stdout_logfile_maxbytes=10MB
priority=350
